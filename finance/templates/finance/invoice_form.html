{% extends "accounts/base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8">

  <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 dark:text-white text-center">
    ðŸ§¾ Create Invoice
  </h1>

  <form method="POST" class="bg-white dark:bg-gray-900 shadow-lg rounded-2xl p-6 sm:p-8 space-y-6">
    {% csrf_token %}

    <!-- Class Dropdown -->
    <div class="space-y-1">
      <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Class</label>
      <select id="class-select" name="school_class" class="form-input w-full">
        <option value="">Select Class</option>
        {% for cls in classes %}
          <option value="{{ cls.id }}">{{ cls.name }}</option>
        {% endfor %}
      </select>
      {% if form.school_class.errors %}
        <p class="text-red-600 text-sm">{{ form.school_class.errors|striptags }}</p>
      {% endif %}
    </div>

    <!-- Student Dropdown -->
    <div class="space-y-1">
      <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Student</label>
      {{ form.student }}
      {% if form.student.errors %}
        <p class="text-red-600 text-sm">{{ form.student.errors|striptags }}</p>
      {% endif %}
    </div>

    <!-- Fee Template Dropdown -->
    <!-- Fee Template Dropdown -->
<div class="space-y-1">
    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Fee Template</label>
    {{ form.fee_template }}
</div>


    <!-- Title -->
    <div class="space-y-1">
      <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Title</label>
      {{ form.title }}
      {% if form.title.errors %}
        <p class="text-red-600 text-sm">{{ form.title.errors|striptags }}</p>
      {% endif %}
    </div>

    <!-- Total Amount -->
    <div class="space-y-1">
      <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Total Amount</label>
      {{ form.total_amount }}
      {% if form.total_amount.errors %}
        <p class="text-red-600 text-sm">{{ form.total_amount.errors|striptags }}</p>
      {% endif %}
    </div>

    <!-- Due Date, Session, Term -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Due Date</label>
        {{ form.due_date }}
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Session</label>
        {{ form.session }}
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200">Term</label>
        {{ form.term }}
      </div>
    </div>

    <div class="text-center pt-6">
      <button type="submit" class="px-8 py-3 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-bold shadow">
        Create Invoice
      </button>
    </div>
  </form>
</div>

<!-- JS for dynamic dropdowns -->

<script>
const classSelect = document.getElementById("class-select");
const studentSelect = document.getElementById("id_student");
const templateSelect = document.getElementById("fee-template-select");
const totalInput = document.getElementById("id_total_amount");

// Filter students & templates by class
classSelect.addEventListener("change", () => {
    const selectedClass = classSelect.value;

    // Filter templates
    [...templateSelect.options].forEach(opt => {
        if (!opt.value) return;
        opt.style.display = opt.dataset.class === selectedClass ? "block" : "none";
    });
    templateSelect.value = "";

    // Filter students
    [...studentSelect.options].forEach(opt => {
        if (!opt.value) return;
        opt.style.display = opt.dataset.class === selectedClass ? "block" : "none";
    });
    studentSelect.value = "";
});

// Auto-fill total amount
templateSelect.addEventListener("change", () => {
    const selectedOption = templateSelect.selectedOptions[0];
    if (selectedOption) {
        totalInput.value = selectedOption.dataset.amount;
    }
});
</script>
{% endblock %}
