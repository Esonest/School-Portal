{% extends "accounts/base.html" %}
{% block content %}

<div class="min-h-screen bg-gray-100 dark:bg-gray-950 py-12">
  <div class="max-w-3xl mx-auto px-4">

    <!-- ================= HEADER ================= -->
    <div class="mb-10 text-center">
      <h1 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">
        {% if is_edit %}Edit Fee Template{% else %}Create Fee Template{% endif %}
      </h1>
      <p class="text-gray-500 dark:text-gray-400 mt-2">
        Define the fee structure for a class
      </p>
    </div>

    <!-- ================= FORM CARD ================= -->
    <div class="bg-white dark:bg-gray-900 shadow-xl rounded-xl p-8">
      <form method="post" class="space-y-6">
        {% csrf_token %}

        <!-- Class -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            Class
          </label>
          {{ form.school_class }}
          {% if form.school_class.errors %}
            <p class="text-red-500 text-sm mt-1">
              {{ form.school_class.errors|striptags }}
            </p>
          {% endif %}
        </div>

        <!-- Template Name -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            Template Name
          </label>
          {{ form.name }}
          {% if form.name.errors %}
            <p class="text-red-500 text-sm mt-1">
              {{ form.name.errors|striptags }}
            </p>
          {% endif %}
        </div>

        <!-- Amount -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            Amount
          </label>
          <input
            type="text"
            name="amount"
            value="{{ form.amount.value|default_if_none:'' }}"
            placeholder="Enter amount"
            class="w-full rounded-lg border-gray-300 dark:border-gray-700
                   shadow-sm bg-white dark:bg-gray-800
                   text-gray-900 dark:text-gray-100
                   focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500
                   px-3 py-2"
          />
          {% if form.amount.errors %}
            <p class="text-red-500 text-sm mt-1">
              {{ form.amount.errors|striptags }}
            </p>
          {% endif %}
        </div>

        <!-- Active -->
        <div class="flex items-center gap-3 pt-2">
          {{ form.is_active }}
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Active?
          </label>
        </div>

        <!-- ================= ACTIONS ================= -->
        <div class="flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700">
          <a href="{% url 'finance:fee_template_list' %}"
             class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white font-medium">
            ‚Üê Cancel
          </a>

          <button type="submit"
                  id="submitBtn"
                  class="px-6 py-2 rounded-lg bg-indigo-600 text-white font-semibold
                         hover:bg-indigo-700 transition
                         disabled:opacity-60 disabled:cursor-not-allowed">
            {% if is_edit %}Update Template{% else %}Save Template{% endif %}
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

<script>
  // Disable submit button on submit
  const form = document.querySelector("form");
  const btn = document.getElementById("submitBtn");
  if (form && btn) {
    form.addEventListener("submit", () => {
      btn.disabled = true;
      btn.innerText = "Saving...";
    });
  }

  // Format amount input with commas
  document.addEventListener("DOMContentLoaded", () => {
    const amountInput = document.querySelector('input[name="amount"]');
    if (!amountInput) return;

    amountInput.addEventListener("input", () => {
      let raw = amountInput.value.replace(/[^\d.]/g, "");
      let [integer, decimal] = raw.split(".");
      if (decimal !== undefined) decimal = decimal.slice(0, 2);
      integer = integer.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      amountInput.value = decimal !== undefined ? `${integer}.${decimal}` : integer;
    });
  });
</script>

{% endblock %}
