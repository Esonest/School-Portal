{% extends "accounts/base.html" %}
{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-100 p-4 sm:p-6 flex justify-center">
  <div class="w-full max-w-3xl">

    <!-- Page Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-{{ school.theme_color }}-700">
        Add Student
      </h1>
      <p class="text-sm text-gray-600 mt-1">
        {{ school.name }} â€” Student registration
      </p>
    </div>

    <!-- Django messages -->
    {% if messages %}
      <div class="space-y-4 mb-6">
        {% for message in messages %}
          <div class="rounded-lg p-4 text-sm
                      {% if message.tags == 'success' %}bg-green-50 border border-green-200 text-green-700
                      {% elif message.tags == 'error' %}bg-red-50 border border-red-200 text-red-700
                      {% else %}bg-gray-50 border border-gray-200 text-gray-700{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Form Card -->
    <form method="POST" enctype="multipart/form-data"
          class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 sm:p-8 space-y-6">
      {% csrf_token %}

      <!-- User Fields: Email, First Name, Last Name, Username, Password -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- Email -->
        <div class="sm:col-span-2">
          <label class="block mb-1 font-semibold text-gray-700">Email</label>
          {% render_field form.email class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.email.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.email.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- First Name -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.first_name.label_tag }}</label>
          {% render_field form.first_name class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.first_name.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.first_name.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Last Name -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.last_name.label_tag }}</label>
          {% render_field form.last_name class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.last_name.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.last_name.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Username -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.username.label_tag }}</label>
          {% render_field form.username class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.username.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.username.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Password -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.password.label_tag }}</label>
          <div class="relative">
            {% render_field form.password class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" id=form.password.auto_id %}
            <button type="button"
                    class="absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-gray-200 text-gray-500"
                    onclick="togglePasswordIcon('{{ form.password.auto_id }}', this)">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                   stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
            </button>
          </div>
          {% if form.password.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.password.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Admission Number -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.admission_no.label_tag }}</label>
          {% render_field form.admission_no class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.admission_no.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.admission_no.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Date of Birth -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.dob.label_tag }}</label>
          {% render_field form.dob class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.dob.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.dob.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Gender -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.gender.label_tag }}</label>
          {% render_field form.gender class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.gender.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.gender.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- School Class -->
        <div>
          <label class="block mb-1 font-semibold text-gray-700">{{ form.school_class.label_tag }}</label>
          {% render_field form.school_class class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.school_class.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.school_class.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Photo -->
        <div class="sm:col-span-2">
          <label class="block mb-1 font-semibold text-gray-700">{{ form.photo.label_tag }}</label>
          {% render_field form.photo class="w-full rounded-lg border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-blue-400" %}
          {% if form.photo.errors %}
            <ul class="text-red-500 text-sm mt-1 list-disc pl-5">
              {% for error in form.photo.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

      </div>

      <!-- Submit Button -->
      <div class="pt-4">
        <button type="submit"
                class="w-full sm:w-auto bg-gradient-to-r from-blue-500 to-blue-600
                       hover:from-blue-600 hover:to-blue-700
                       text-white font-semibold px-6 py-3 rounded-lg shadow transition">
          Save Student
        </button>
      </div>

    </form>
  </div>
</div>

<script>
function togglePasswordIcon(fieldId, btn) {
    const input = document.getElementById(fieldId);
    const isPassword = input.type === "password";
    input.type = isPassword ? "text" : "password";

    btn.innerHTML = isPassword 
      ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
           <path stroke-linecap="round" stroke-linejoin="round"
                 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
           <path stroke-linecap="round" stroke-linejoin="round"
                 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
         </svg>`
      : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
           <path stroke-linecap="round" stroke-linejoin="round"
                 d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a10.05 10.05 0 012.043-3.385M6.1 6.1l11.8 11.8M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
         </svg>`;
}
</script>
{% endblock %}
