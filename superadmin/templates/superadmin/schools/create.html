{% extends "accounts/base.html" %}
{% load static %}
{% block content %}

<div class="max-w-4xl mx-auto px-4 sm:px-6 py-6">

<form method="POST" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}

    <!-- Live Preview -->
    <div class="p-4 border rounded bg-gray-50">
        <p class="text-sm text-gray-500 mb-2">Live Preview</p>

        <div class="flex flex-col sm:flex-row items-center gap-4">

            <!-- Logo Preview -->
            <img
                id="logo-preview"
                src="{% if form.instance.logo %}{{ form.instance.logo.url }}{% else %}{% static 'img/school_logos/default_logo.png' %}{% endif %}"
                alt="Logo"
                class="h-20 w-20 sm:h-24 sm:w-24 object-contain border rounded bg-white"
            >

            <!-- School Name -->
            <h2
                id="school-name-preview"
                class="text-2xl font-bold text-indigo-600 text-center sm:text-left"
            >
                {{ form.name.value|default:"School Name" }}
            </h2>

            <!-- Principal Signature Preview -->
            <img
                id="signature-preview"
                src="{% if form.instance.principal_signature %}{{ form.instance.principal_signature.url }}{% else %}{% static 'img/schools/default_signature.png' %}{% endif %}"
                alt="Signature"
                class="h-16 w-28 object-contain"
            >
        </div>
    </div>

    <!-- Form fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <div>
            {{ form.name.label_tag }}
            {{ form.name }}
        </div>

        <div>
            {{ form.address.label_tag }}
            {{ form.address }}
        </div>

        <div>
            {{ form.motto.label_tag }}
            {{ form.motto }}
        </div>

        <div>
            {{ form.theme_color.label_tag }}
            {{ form.theme_color }}
        </div>

        <div>
            {{ form.logo.label_tag }}
            {{ form.logo }}
        </div>

        <div>
            {{ form.principal_signature.label_tag }}
            {{ form.principal_signature }}
        </div>

    </div>

    <button type="submit" class="mt-4 px-4 py-2 rounded bg-indigo-600 text-white">
        Save School
    </button>
</form>
</div>

<script>
    const nameInput = document.getElementById("school-name-input");
    const namePreview = document.getElementById("school-name-preview");
    const colorSelect = document.getElementById("theme-color-select");

    const logoInput = document.getElementById("id_logo");
    const logoPreview = document.getElementById("logo-preview");

    const signatureInput = document.getElementById("id_principal_signature");
    const signaturePreview = document.getElementById("signature-preview");

    function updatePreview() {
        // Name
        namePreview.textContent = nameInput.value || "School Name";

        // Color (UNCHANGED)
        const color = colorSelect.value || "indigo";
        namePreview.className = `text-2xl font-bold text-${color}-600`;
    }

    // âœ… Live logo preview for file upload
    logoInput.addEventListener("change", function () {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = e => logoPreview.src = e.target.result;
            reader.readAsDataURL(this.files[0]);
        }
    });

    // Signature preview
    signatureInput.addEventListener("change", function () {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = e => signaturePreview.src = e.target.result;
            reader.readAsDataURL(this.files[0]);
        }
    });

    nameInput.addEventListener("input", updatePreview);
    colorSelect.addEventListener("change", updatePreview);

    // Initial render
    updatePreview();
</script>

{% endblock %}
