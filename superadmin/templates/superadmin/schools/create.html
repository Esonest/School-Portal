{% extends "accounts/base.html" %}
{% load static %}
{% block content %}

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Live Preview -->
    <div class="mb-4 p-4 border rounded bg-gray-50">
        <p class="text-sm text-gray-500 mb-1">Live Preview</p>
        <div class="flex items-center space-x-4">
            <!-- Logo Preview -->
            <img id="logo-preview" src="{% static 'img/school_logos/default_logo.png' %}" alt="Logo" class="h-16 w-16 object-contain">

            <!-- School Name -->
            <h2 id="school-name-preview" class="text-2xl font-bold text-indigo-600">
                {{ form.name.value|default:"School Name" }}
            </h2>

            <!-- Principal Signature Preview -->
            <img id="signature-preview" src="{% if form.instance.principal_signature %}{{ form.instance.principal_signature.url }}{% else %}{% static 'img/schools/default_signature.png' %}{% endif %}" 
                 alt="Signature" class="h-16 w-16 object-contain">
        </div>
    </div>

    {{ form.name.label_tag }}
    {{ form.name }}

    {{ form.address.label_tag }}
    {{ form.address }}

    {{ form.motto.label_tag }}
    {{ form.motto }}

    {{ form.logo.label_tag }}
    {{ form.logo }}

    {{ form.theme_color.label_tag }}
    {{ form.theme_color }}

    {{ form.principal_signature.label_tag }}
    {{ form.principal_signature }}

    <button type="submit" class="mt-4 px-4 py-2 rounded bg-indigo-600 text-white">
        Save School
    </button>
</form>

<script>
    // Django static root (this becomes "/static/")
    const STATIC_URL = "{{ STATIC_URL }}";

    const nameInput = document.getElementById("school-name-input");
    const namePreview = document.getElementById("school-name-preview");
    const colorSelect = document.getElementById("theme-color-select");
    const logoSelect = document.getElementById("id_logo");
    const logoPreview = document.getElementById("logo-preview");
    const signatureInput = document.getElementById("id_principal_signature");
    const signaturePreview = document.getElementById("signature-preview");

    function updatePreview() {
        // Name
        namePreview.textContent = nameInput.value || "School Name";

        // Theme color
        const color = colorSelect.value || "indigo";
        namePreview.className = `text-2xl font-bold text-${color}-600`;

        // Logo (THIS IS THE FIX)
        const selectedLogo = logoSelect.value;

        if (selectedLogo && selectedLogo !== "") {
            logoPreview.src = STATIC_URL + selectedLogo;
        } else {
            logoPreview.src = STATIC_URL + "img/school_logos/default_logo.png";
        }
    }

    // Signature preview
    signatureInput.addEventListener("change", function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => signaturePreview.src = e.target.result;
            reader.readAsDataURL(file);
        }
    });

    nameInput.addEventListener("input", updatePreview);
    colorSelect.addEventListener("change", updatePreview);
    logoSelect.addEventListener("change", updatePreview);

    // Initial render
    updatePreview();
</script>



{% endblock %}
