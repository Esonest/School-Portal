{% extends "accounts/base.html" %}
{% load static %}
{% block content %}

<div class="p-6">
    <h1 class="text-2xl font-bold mb-4">Edit School</h1>

    <form method="POST" enctype="multipart/form-data"
          class="bg-white p-6 rounded shadow w-full max-w-xl">

        {% csrf_token %}

        <!-- Live Preview -->
        <div class="mb-4 p-4 border rounded bg-gray-50">
            <p class="text-sm text-gray-500 mb-1">Live Preview</p>
            <div class="flex items-center space-x-4">
                <!-- Logo Preview -->
                <img id="logo-preview"
                     src="{% if school.logo %}{% static school.logo %}{% else %}{% static 'img/schools/default_logo.png' %}{% endif %}"
                     alt="Logo" class="h-16 w-16 object-contain">

                <!-- School Name Preview -->
                <h2 id="school-name-preview"
                    class="text-2xl font-bold text-{{ school.theme_color|default:'indigo' }}-600">
                    {{ school.name|default:"School Name" }}
                </h2>

                <!-- Principal Signature Preview -->
                <img id="signature-preview"
                     src="{% if school.principal_signature %}{{ school.principal_signature.url }}{% else %}{% static 'img/schools/default_signature.png' %}{% endif %}"
                     alt="Signature" class="h-16 w-16 object-contain">
            </div>
        </div>

        {{ form.name.label_tag }}
        {{ form.name }}

        {{ form.address.label_tag }}
        {{ form.address }}

        {{ form.motto.label_tag }}
        {{ form.motto }}

        {{ form.logo.label_tag }}
        {{ form.logo }}

        {{ form.theme_color.label_tag }}
        {{ form.theme_color }}

        {{ form.principal_signature.label_tag }}
        {{ form.principal_signature }}

        <button class="bg-blue-600 text-white px-4 py-2 rounded mt-4">
            Update School
        </button>
    </form>
</div>

<script>
    const nameInput = document.getElementById("id_name");
    const namePreview = document.getElementById("school-name-preview");
    const colorSelect = document.getElementById("id_theme_color");
    const logoSelect = document.getElementById("id_logo");
    const logoPreview = document.getElementById("logo-preview");
    const signatureInput = document.getElementById("id_principal_signature");
    const signaturePreview = document.getElementById("signature-preview");

    function updatePreview() {
        // Update school name
        namePreview.textContent = nameInput.value || "School Name";

        // Update theme color
        const color = colorSelect.value || "indigo";
        namePreview.className = `text-2xl font-bold text-${color}-600`;

        // Update logo preview
        const selectedLogo = logoSelect.value;
        if(selectedLogo){
            logoPreview.src = "{% static '' %}" + selectedLogo;
        } else if(logoPreview.src === ""){
            logoPreview.src = "{% static 'img/schools/default_logo.png' %}";
        }
    }

    // Show principal signature preview on file selection
    signatureInput.addEventListener("change", function(){
        const file = signatureInput.files[0];
        if(file){
            const reader = new FileReader();
            reader.onload = function(e){
                signaturePreview.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    // Event listeners for live updates
    nameInput.addEventListener("input", updatePreview);
    colorSelect.addEventListener("change", updatePreview);
    logoSelect.addEventListener("change", updatePreview);

    // Initial render (pre-filled from instance)
    updatePreview();
</script>

{% endblock %}
