{% extends "accounts/base.html" %}
{% block content %}
<div class="p-6">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">Students</h1>
    <div class="flex gap-3">
      <a href="{% url 'superadmin:create_student' %}" class="bg-blue-600 text-white px-4 py-2 rounded">+ Add</a>
      <a href="{% url 'superadmin:student_bulk_upload' %}" class="bg-gray-100 px-4 py-2 rounded">Bulk Upload</a>
    </div>
  </div>

  <form method="get" class="mb-4 flex gap-2">
    <input name="q" value="{{ q }}" placeholder="Search name, username, admission_no" class="border p-2 rounded w-1/3">
    <select name="class_id" class="border p-2 rounded">
      <option value="">All classes</option>
      {% for c in classes %}<option value="{{ c.id }}" {% if class_id|default:'' == c.id|stringformat:"s" %}selected{% endif %}>{{ c.name }}</option>{% endfor %}
    </select>
    
    <button class="bg-indigo-600 text-white px-3 py-2 rounded">Filter</button>
  </form>

  <div class="bg-white shadow rounded overflow-x-auto">
    <table class="min-w-full text-left">
      <thead class="bg-gray-50">
        <tr>
          <th class="p-3">Photo</th><th class="p-3">Name</th><th class="p-3">Admission</th><th class="p-3">Class</th><th class="p-3">Status</th><th class="p-3">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for s in students %}
        <tr class="border-b hover:bg-gray-50">
          <td class="p-2">
            {% if s.photo %}
              <img src="{{ s.photo.url }}" class="h-10 w-10 rounded-full object-cover">
            {% elif s.user.profile_picture %}
              <img src="{{ s.user.profile_picture.url }}" class="h-10 w-10 rounded-full object-cover">
            {% else %}
              <div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">N/A</div>
            {% endif %}
          </td>
          <td class="p-2">{{ s.user.get_full_name }} <div class="text-xs text-gray-400">{{ s.user.username }}</div></td>
          <td class="p-2">{{ s.admission_no }}</td>
          <td class="p-2">{{ s.school_class }}</td>
          <td class="p-2">
            <a class="text-blue-600" href="{% url 'superadmin:student_profile' s.id %}">View</a> |
            <a class="text-indigo-600" href="{% url 'superadmin:edit_student' s.id %}">Edit</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="p-4 text-center text-gray-500">No students found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- pagination -->
  <div class="mt-4">
    <nav class="flex justify-between items-center">
      <div>Page {{ students.number }} of {{ students.paginator.num_pages }}</div>
      <div class="space-x-2">
        {% if students.has_previous %}
          <a href="?page={{ students.previous_page_number }}&q={{ q }}&class_id={{ class_id }}&status={{ status }}" class="px-3 py-1 border rounded">Prev</a>
        {% endif %}
        {% if students.has_next %}
          <a href="?page={{ students.next_page_number }}&q={{ q }}&class_id={{ class_id }}&status={{ status }}" class="px-3 py-1 border rounded">Next</a>
        {% endif %}
      </div>
    </nav>
  </div>

</div>
{% endblock %}
