{% extends 'accounts/base.html' %}
{% block content %}
<div class="max-w-7xl mx-auto px-6 py-10 bg-gradient-to-br from-indigo-50 via-white to-blue-50 min-h-screen">

  <!-- ðŸ§‘ðŸ»â€ðŸŽ“ Dashboard Header -->
  <div class="flex flex-col md:flex-row items-center justify-between mb-10 bg-white border border-gray-100 rounded-2xl shadow-sm p-6">
    <div class="flex items-center space-x-4">
      {% if student.photo %}
        <img src="{{ student.photo.url }}" alt="{{ student.full_name }}" class="w-16 h-16 rounded-full object-cover border border-gray-200 shadow-sm">
      {% else %}
        <div class="w-16 h-16 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-xl shadow-sm">
          {{ student.full_name|slice:":1" }}
        </div>
      {% endif %}
      <div>
        <h1 class="text-2xl font-bold text-indigo-800">Welcome, {{ student.full_name }}</h1>
        <p class="text-sm text-gray-600">Class: {{ student.school_class }} Â· Admission No: {{ student.admission_no }}</p>
      </div>
    </div>

    <a href="{% url 'students:profile' %}" 
       class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg shadow hover:bg-indigo-700 transition">
      Edit Profile
    </a>
  </div>

  <!-- ðŸ“Š Overall Performance Summary -->
  <div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6 mb-10">
    <h2 class="text-lg font-semibold text-indigo-700 mb-4">Performance Summary</h2>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
      <div class="text-center">
        <p class="text-3xl font-bold text-indigo-700">
          {{ average_score|default:"--" }}%
        </p>
        <p class="text-sm text-gray-600">Average Score</p>
      </div>
      <div class="text-center">
        <p class="text-3xl font-bold text-green-600">
          {{ passed_exams|default:0 }}
        </p>
        <p class="text-sm text-gray-600">Exams Passed</p>
      </div>
      <div class="text-center">
        <p class="text-3xl font-bold text-blue-600">
          {{ total_exams|default:0 }}
        </p>
        <p class="text-sm text-gray-600">Total Exams</p>
      </div>
    </div>

    <!-- Progress Bar -->
    {% if average_score %}
    <div class="mt-6">
      <div class="flex justify-between mb-1 text-sm font-medium text-gray-600">
        <span>Progress Toward Excellence</span>
        <span>{{ average_score }}%</span>
      </div>
      <div class="w-full bg-gray-100 rounded-full h-3">
        <div class="bg-indigo-600 h-3 rounded-full transition-all duration-500"
             style="width: {{ average_score }}%;"></div>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- ðŸ“ Profile + Results -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">

    <!-- Profile -->
    <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-lg transition">
      <h2 class="text-lg font-semibold text-indigo-700 mb-4">Payment Details</h2>
      <ul class="text-gray-700 space-y-2">
        <li><strong>Full Name:</strong> {{ student.full_name }}</li>
        <li><strong>Payment Information:</strong>
          <a href="{% url 'finance:student_dashboard'%}" 
                 class="px-3 py-1 bg-indigo-600 text-white text-xs rounded-lg hover:bg-indigo-700 transition">
                 View Payment</a>
        <li><strong>Class:</strong> {{ student.school_class }}</li>
      </ul>
    </div>

    <!-- Recent Results -->
    <div class="md:col-span-2 bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-lg transition">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-indigo-700">Recent Results</h2>
        <a href="{% url 'cbt:exam_list' %}" 
           class="text-sm px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
          CBT Exams & Results
        </a>
      </div>
      <ul class="divide-y divide-gray-200">
        {% for r in results %}
          <li class="py-4 flex justify-between items-center">
            <div>
              <p class="font-medium text-gray-800">{{ r.exam.title }}
                <span class="text-sm text-gray-500">({{ r.exam.term }} {{ r.exam.session }})</span>
              </p>
              <p class="text-sm text-gray-600">Total: {{ r.total_score }} Â· Grade: {{ r.grade }}</p>
            </div>
            <div class="space-x-2">
              <a href="{% url 'students:result_detail' pk=r.pk %}" 
                 class="px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition">View</a>
              <a href="{% url 'students:result_pdf' pk=r.pk %}" 
                 class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-lg hover:bg-gray-200 transition">PDF</a>
            </div>
          </li>
        {% empty %}
          <li class="py-4 text-gray-500 text-center">No results yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- ðŸ“ Assignments + Notes -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">

    <!-- Assignments -->
    <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-lg transition">
      <h2 class="text-lg font-semibold text-indigo-700 mb-4">Assignments</h2>
      <ul class="divide-y divide-gray-100">
        {% for a in assignments %}
          <li class="py-3 flex justify-between items-center">
            <div>
              <a href="{% url 'assignments:student_assignment_detail' a.pk %}" 
                 class="text-indigo-600 font-medium hover:underline">
                 {{ a.title }}
              </a>
              <p class="text-sm text-gray-600">Due: {{ a.due_date|date:"M d, Y" }}</p>
            </div>
            {% if a.due_date < now %}
              <span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded-full">Overdue</span>
            {% else %}
              <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">Active</span>
            {% endif %}
          </li>
        {% empty %}
          <li class="py-3 text-gray-500 text-center">No assignments yet.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Notes -->
    <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-lg transition flex flex-col justify-between">
      <div>
        <h2 class="text-lg font-semibold text-indigo-700 mb-4">Class Notes</h2>
        <p class="text-gray-600 mb-6 text-sm">Access all uploaded materials and class notes easily.</p>
      </div>
      <a href="{% url 'students:notes_list' %}" 
         class="inline-flex justify-center px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg shadow hover:bg-indigo-700 transition">
         View Notes
      </a>
    </div>
  </div>

  <!-- ðŸ’» CBT Section -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Active CBTs -->
    <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-lg transition">
      <h2 class="text-lg font-semibold text-indigo-700 mb-4">Active CBT Exams</h2>
      {% if active_cbts %}
        <ul class="space-y-3">
          {% for exam in active_cbts %}
            <li class="py-3 border-b border-gray-50 flex justify-between items-center">
              <div>
                <p class="font-medium text-gray-800">{{ exam.title }} ({{ exam.subject }})</p>
                <p class="text-sm text-gray-500">Started: {{ exam.start_time|date:"M d, Y H:i" }}</p>
              </div>
              <a href="{% url 'cbt:exam_list' %}" 
                 class="px-3 py-1 bg-indigo-600 text-white text-xs rounded-lg hover:bg-indigo-700 transition">
                 Start Exam
              </a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-gray-500 text-sm">No active CBTs right now.</p>
      {% endif %}
    </div>

    <!-- Upcoming CBTs -->
    <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-lg transition">
      <h2 class="text-lg font-semibold text-indigo-700 mb-4">Upcoming CBT Exams</h2>
      {% if upcoming_cbts %}
        <ul class="space-y-3">
          {% for exam in upcoming_cbts %}
            <li class="py-3 border-b border-gray-50">
              <p class="font-medium text-gray-800">{{ exam.title }} ({{ exam.subject }})</p>
              <p class="text-sm text-gray-500">Starts: {{ exam.start_time|date:"M d, Y H:i" }}</p>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-gray-500 text-sm">No upcoming CBTs.</p>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
